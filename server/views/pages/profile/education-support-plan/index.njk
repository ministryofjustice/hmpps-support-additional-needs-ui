{% extends "../layout.njk" %}
{% from "./components/macro.njk" import renderEducationSupportPlan %}
{% from "./components/macro.njk" import noEducationSupportPlan %}
{% from "./components/macro.njk" import declinedEducationSupportPlan %}
{% from "./components/macro.njk" import errorRetrievingApiData %}

{% set pageId = 'profile-education-support-plan' %}
{% set pageTitle = "Support for additional needs - Education support plan" %}

{% block content %}
  <div class="govuk-grid-row profile-education-support-plan">

    {% if educationSupportPlan.isFulfilled() and educationSupportPlanLifecycleStatus.isFulfilled() %}
      {% set educationSupportPlan = educationSupportPlan.value %}
      {% set educationSupportPlanLifecycleStatus = educationSupportPlanLifecycleStatus.value %}

      <div class="govuk-grid-column-two-thirds app-u-print-full-width">

        {% if educationSupportPlanLifecycleStatus.status === 'PLAN_DECLINED' %}

          {{ declinedEducationSupportPlan({
            prisonerSummary: prisonerSummary,
            planDeclined: educationSupportPlanLifecycleStatus.planDeclined
          }) }}

        {% else %}

          {% if educationSupportPlan %}

            {% if educationSupportPlanLifecycleStatus.status === 'INACTIVE_PLAN' %}
              {{ govukNotificationBanner({
                text: prisonerSummary | formatFirst_name_Last_name + ' is no longer eligible for an education support plan',
                attributes: {
                  'data-qa': 'inactive-plan-notification'
                }
              }) }}
            {% endif %}

            {{ renderEducationSupportPlan({
              prisonerSummary: prisonerSummary,
              educationSupportPlan: educationSupportPlan
            }) }}

          {% else %}

            {{ noEducationSupportPlan({
              prisonerSummary: prisonerSummary,
              planStatus: educationSupportPlanLifecycleStatus.status,
              planCreationDeadlineDate: educationSupportPlanLifecycleStatus.planCreationDeadlineDate
            }) }}

          {% endif %}

        {% endif %}
        <div class="govuk-grid-column-one-third app-u-print-full-width">
          {# column for the actions menu #}
        </div>
      </div>

    {% else %}
      <div class="govuk-grid-column-two-thirds app-u-print-full-width">
        {{ errorRetrievingApiData() }}
      </div>
    {% endif %}

  </div>
{% endblock %}
